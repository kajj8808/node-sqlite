<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <link rel="stylesheet" href="/styles/reset.css" />
    <link rel="stylesheet" href="/styles/theme.css" />
    <link rel="stylesheet" href="/styles/group.css" />
  </head>
  <body>
    <div class="title-container">
      <h1>Image Gallery</h1>
    </div>
    <div class="image_container"></div>
    <div class="image_viewer hidden">
      <button class="close_btn">âœ˜</button>
    </div>
  </body>
  <script>
    const imageContainer = document.querySelector(".image_container");
    const titleContainer = document.querySelector(".title-container");
    const imageViewer = document.querySelector(".image_viewer");
    const closeButton = document.querySelector(".close_btn");

    const checkCurrentGroupName = (groupName) =>
      groupName === "group_one" || groupName === "group_two";

    const pathParts = window.location.pathname.split("/");
    const groupName = pathParts[pathParts.length - 1];
    function onImageClick(e) {
      imageViewer.style.backgroundImage = e.target.style.backgroundImage;
      imageViewer.classList.remove("hidden");
      imageViewer.classList.add("visible");
    }
    function onCloseClick() {
      imageViewer.classList.remove("visible");
      imageViewer.classList.add("hidden");
    }

    closeButton.addEventListener("click", onCloseClick);
    window.onload = async () => {
      if (checkCurrentGroupName(groupName)) {
        const subtitle = document.createElement("h3");
        subtitle.innerText = groupName;
        titleContainer.appendChild(subtitle);
        const json = await (
          await fetch(
            `http://susuya.org:8080/get_contents/group?name=${groupName}&offset=0`
          )
        ).json();
        if (json.ok) {
          const contents = json.contents;
          contents.map((content) => {
            const imageBox = document.createElement("div");
            imageBox.style.backgroundImage = `url("http://susuya.org:8080/image/${content.image}")`;
            imageBox.classList.add("image_box");
            imageBox.id = content.id;
            imageBox.addEventListener("click", onImageClick);

            imageContainer.appendChild(imageBox);
          });
        }
      }
    };
  </script>
</html>
